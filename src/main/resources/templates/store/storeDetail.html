<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>

<body>


<!-- navbar fragment -->
<nav th:replace="~{fragment/navbar :: copy}"></nav>



<!-- 메인 -->
<div>
  <div>
    <div class="space-y-6" style="margin:0 auto;max-width:1000px">
      <div class="rounded-lg border bg-card text-card-foreground shadow-sm" data-v0-t="card">
        <div class="flex flex-col space-y-1.5 p-4">
          <div class="flex items-center space-x-4">
            <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="h-6 w-6"
                    rounded-lg border bg-card text-card-foreground shadow-sm >
              <circle cx="8" cy="21" r="1"></circle>
              <circle cx="19" cy="21" r="1"></circle>
              <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"></path>
            </svg>
            <h2 class="text-lg font-bold tracking-tight">Your order has been placed</h2>
          </div>
        </div>
        <div class="p-4">
          <div>
            <div>
              <div class="space-y-6" style="margin:0 auto;max-width:1000px">
                <div class="rounded-lg border bg-card text-card-foreground shadow-sm" data-v0-t="card">
                  <div class="flex flex-col space-y-1.5 p-4">
                    <div class="flex items-center space-x-4">
                     <!-- <h2 th:text="${store.mainTitle}" class="text-lg font-bold tracking-tight">맛집 이름 </h2>-->
                    </div>
                  </div>
                  <div class="p-4">



                    <div class="grid grid-cols-3 gap-4 text-sm">
                      <!-- 첫 번째 열 (이미지) -->
                      <div class="col-span-2">
                        <img
                                alt="맛집 이미지"
                                class="rounded-md overflow-hidden"
                                style="width: 100%; height: auto; object-fit: cover; margin-top: 0;"
                                th:src="${store.mainImgNormal}"
                        />
                      </div>

                      <!-- 두 번째 열 (지도) -->
                      <div class="col-span-1">
                        <div class="relative" style="height: 100%;">
                          <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=2204b4bb2b8843221ccb59e6a5fa9157&libraries=services,clusterer,drawing"></script>
                          <div id="map" style="position: absolute; width:100%;height:100%;"></div>

                        <script th:inline="javascript">


                        // 지도 생성
                        var mapContainer = document.getElementById('map'),
                            mapOption = {
                                center: new kakao.maps.LatLng([[${store.lat}]], [[${store.lng}]]), // 지도의 중심좌표
                                level: 3 // 지도의 확대 레벨
                            };

                        var map = new kakao.maps.Map(mapContainer, mapOption);



                        //마커 생성
                        var markerPosition  = new kakao.maps.LatLng([[${store.lat}]], [[${store.lng}]]);
                        var marker = new kakao.maps.Marker({
                        position: markerPosition
                        });

                        // 마커가 지도 위에 표시되도록 설정
                        marker.setMap(map);



                       //인포윈도우 표시 위치
                        var iwContent = '<div style="padding:5px;" id="storeMainTitle">' + /*[[${store.mainTitle}]]*/ + '</div>',
                        //var iwContent = '<div style="padding:5px;">[[${store.mainTitle}]]</div>',
                        iwPosition = new kakao.maps.LatLng([[${store.lat}]], [[${store.lng}]]);


                        // 인포윈도우 생성
                        var infowindow = new kakao.maps.InfoWindow({
                            position : iwPosition,
                            content : iwContent
                        });

                        // 마커 위에 인포윈도우를 표시합니다. 두번째 파라미터인 marker를 넣어주지 않으면 지도 위에 표시
                        infowindow.open(map, marker);

                        //지도 위의 마커를 제거
                        // marker.setMap(null);
                        </script>
                        </div>
                      </div>
                    </div>


                <!-- 첫번째 -->
                <div class="grid-cols-2 rounded-lg border bg-card text-card-foreground shadow-sm" style="margin-top: 20px;" data-v0-t="card">


                  <div class="flex items-center justify-between">
                    <div  class="flex items-center space-x-4">
                      <svg
                              xmlns="http://www.w3.org/2000/svg"
                              width="24"
                              height="24"
                              viewBox="0 0 24 24"
                              fill="none"
                              stroke="currentColor"
                              stroke-width="2"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              class="h-6 w-6"
                      >
                        <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
                        <circle cx="12" cy="10" r="3"></circle>
                      </svg>

                      <h1 th:text="${store.mainTitle}" style="margin-left: 0.2rem;" class="text-2xl font-bold tracking-tight" >맛집 이름</h1>
                    </div>



                    <div class="flex items-center justify-end space-x-4">
                      <button  th:text="${store.addr1}" class="text-m items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-9 rounded-md px-3">
                        맛집 주소
                      </button>
                    </div>

                   <!-- <div style="text-align:right;" class="" th:text="${store.addr1}">맛집 주소</div>-->
                  </div>



                  <div class="p-4">
                    <div class="grid grid-cols-2 gap-4 text-sm">
                      <div>
                        <p class="font-semibold">John Doe</p>
                        <p>123 Street</p>
                        <p>Springfield, IL 62701</p>
                        <p th:text="${store.cntctTel}">United States</p>
                      </div>

                      <!-- <div style="text-align:right;" class="inline-flex items-center justify-center " th:text="${store.addr1}">맛집 주소</div> -->

                      <div class="flex justify-end">
                        <button  class="items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-9 rounded-md px-3">
                          Edit
                        </button>
                      </div>

                    </div>
                  </div>
                </div>




                <div class="rounded-lg border bg-card text-card-foreground shadow-sm" data-v0-t="card">
                  <div class="flex flex-col space-y-1.5 p-4">
                    <div class="flex items-center space-x-4">
                      <svg
                              xmlns="http://www.w3.org/2000/svg"
                              width="24"
                              height="24"
                              viewBox="0 0 24 24"
                              fill="none"
                              stroke="currentColor"
                              stroke-width="2"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              class="h-6 w-6"
                      >
                        <rect width="20" height="14" x="2" y="5" rx="2"></rect>
                        <line x1="2" x2="22" y1="10" y2="10"></line>
                      </svg>
                      <h2 class="text-lg font-bold tracking-tight">Payment method</h2>
                    </div>
                  </div>
                  <div class="p-4">
                    <div class="grid grid-cols-2 gap-4 text-sm">
                      <div>
                        <p th:text="${store.itemCntnts}" class="font-semibold">Credit card</p>
                        <p>Ending in 4242</p>
                      </div>
                      <div class="flex justify-end">
                        <button class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-9 rounded-md px-3">
                          Change
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>



      <!-- 댓글 -->
      <!--
      // v0 by Vercel.
      // https://v0.dev/t/766imnmFGDF
      -->

          <div class="mx-auto max-w-5xl grid gap-4 px-4 md:px-6" style="padding-right: 0px; padding-left: 0px;">
            <div class="grid gap-4">

                <!-- Comment form -->
                <form id="commentForm" method="POST" class="border-2 border-gray-300 dark:border-gray-700 rounded-md p-4">
                    <input type="text" id="commentContent" name="content" placeholder="후기를 등록해주세요." class="w-full border border-gray-300 p-2 rounded-md mb-2">
                    <button type="button"  id="submitButton" th:onclick="|addComment(${store.ucSeq})|" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md float-right">등록</button>
                    <button type="button" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-md mr-1 float-right">취소</button>
                    <!--<div style="clear:both;"></div>-->
                </form>


              <script>
                  document.getElementById('commentContent').addEventListener('keydown', function(event) {
                    if (event.key === 'Enter') {
                        event.preventDefault(); // 폼 제출 방지
                        document.getElementById('submitButton').click(); // 등록 버튼 클릭 이벤트 실행
                    }
                  });
              </script>


              <!-- 댓글 목록(렌더링 부분)-->
              <div id="commentsContainer">
              </div>



               <!-- 댓글 목록(렌더링x) -->
              <div class="flex items-start gap-4 border-2 border-gray-300 dark:border-gray-700 rounded-md p-4">
                <span class="relative flex shrink-0 overflow-hidden rounded-full w-10 h-10 border">
                 <span class="writer_img"><img src="" width="30" height="30" alt="기본 프로필 이미지"/></span>
                </span>

               <div class="grid gap-1 text-sm">
                  <h4 class="font-semibold">Alice Lee</h4>

                  <p class="text-sm text-gray-500 dark:text-gray-400">I love the design of this app. ~</p>


                  <div class="flex items-center gap-0.5 text-xs text-gray-500 dark:text-gray-400">
                    <time>2m</time>
                    <button class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground p-0">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-3 h-3"><path d="m9 18 6-6-6-6"></path></svg>
                        Reply
                    </button>
                  </div>
               </div>
              </div>

              <div data-orientation="horizontal" role="none" class="shrink-0 bg-gray-100 h-[1px] w-full"></div>




            <script th:inline="javascript">

              window.onload = function() {
                const storeId = [[${store.ucSeq}]];
                findAllComment(storeId);
               };

                //비동기적으로 댓글 등록
                function postCommentJson(uri, content) {
                    return new Promise((resolve, reject) => {
                        $.ajax({
                            url: uri,
                            type: 'POST',
                            contentType: 'application/json',
                            data: JSON.stringify({content: content}),
                            success: function(response) {
                                resolve(response); // 응답을 resolve 해야 함
                            },
                            error: function(xhr, status, error) {
                                if (xhr.status === 401) {
                                    window.location.href = "/login";
                                } else {
                                    console.error("오류 발생:" + error);
                                    reject(error);
                                }
                            }
                        });
                    });
                }


               //비동기적으로 댓글 목록 조회
               function getCommentJson_a(uri) {
                  return new Promise((resolve, reject) => {
                      $.ajax({
                          url: uri,
                          type: 'GET',
                          dataType: 'json',
                          //async: false,
                          success: function(response) {
                              console.log("success");
                              resolve(response);
                          },
                          error: function(xhr, status, error) { //xhr :XMLHttpRequest(XHR)
                              if (xhr.status === 401) { // 401 Unauthorized: 로그인되지 않은 경우
                                  // 로그인 페이지로 리다이렉션
                                  //window.location.href = "/login";
                              } else {
                                  // 다른 오류 발생 시 처리
                                  //console.error("오류 발생: " + status + ", " + error);
                                  console.error("오류 발생:" + error);
                              }
                              reject(error);
                          }
                      });
                  });
              }



      //댓글 등록
      async function addComment(storeId) {
        try {
            const content = document.getElementById('commentContent').value; // 댓글 내용 가져오기
            console.log("댓글 내용:", content);
            const uri = "/store/" + storeId + "/comments";
            const response = await postCommentJson(uri, content); // 댓글 등록 요청
            console.log('댓글 response:', response);

            //댓글이 성공적으로 등록된 경우, 댓글 내용을 지우고 댓글 목록 다시 조회
            if (response) {
                document.getElementById('commentContent').value = "";
                findAllComment(storeId);
                //await findAllComment(storeId);
            }
        } catch (error) {
            console.error("오류 발생:" + error);
        }
    }



      //댓글 목록 조회
      async function findAllComment(storeId){

        const uri = "/store/" + storeId + "/comments";

        try {
        const response = await getCommentJson_a(uri);
        comments = response
        console.log(comments);

        const commentsContainer = document.getElementById('commentsContainer');
        commentsContainer.innerHTML = ''; // 기존 댓글 삭제

        let commentHtml = '';

        comments.forEach(comment => {
           commentHtml += `
                <div class="flex justify-between items-start gap-4 border-gray-300 dark:border-gray-700 p-4" style="border-bottom: 1px solid #ccc;">

                        <!-- 프로필 이미지,댓글 내용,시간 왼쪽 배치 -->
                        <div class="flex items-start gap-4">
                            <span class="relative flex shrink-0 overflow-hidden rounded-full w-10 h-10 border">
                                <span class="writer_img">
                                    <img src="https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyMzAzMjZfMjUx%2FMDAxNjc5ODM0MzkxNzg5.SomK3qflKEf0ugQ9HqeikVETiazukyq1aNgj767ZXMMg.d9xeVYIkSi5cL39Zv658_wFaZAWBjQSiApP9Dap3wdgg.PNG.npay1%2F20230326%25A3%25DF213901%25A3%25DF832.png&type=sc960_832" width="40" height="40" alt="기본 프로필 이미지">
                                </span>
                            </span>
                            <div class="grid gap-1 text-sm text-gray-500 dark:text-gray-400">
                                <h4 class="text-black font-bold">${comment.user_userId}</h4>
                                <p class="text-sm text-black font-bold">${comment.content}</p>
                                <div class="flex items-center gap-1 text-xs text-gray-500 dark:text-gray-400">
                                    <time>${comment.created_date}</time>
                                </div>
                            </div>
                        </div>

                        <!-- 수정/삭제 버튼 -->
                         <div>
                           <button class="inline-flex items-center justify-center text-gray-500 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground p-0">
                            수정
                           </button>
                           <button type="button" onclick="deleteComment(${comment.commentId});" class="inline-flex items-center justify-center text-gray-500 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground p-0">
                            삭제
                           </button>
                         </div>
                         </div>
              `;

         });
         commentsContainer.innerHTML = commentHtml;
       } catch (error) {
        console.error("오류 발생:" + error);
        }

      }

      function deleteComment(commentId){
        if (!confirm('선택하신 댓글을 삭제할까요?')) {
              return false;
          }


        const ucSeq = [[ ${store.ucSeq} ]];

        $.ajax({
            url : `/store/${ucSeq}/comments/${commentId}`,
            type : 'delete',
            dataType : 'json',
            async : false,
            success : function (response) {
                alert('삭제되었습니다.');
                findAllComment(ucSeq);
            },
            error : function (request, status, error) {
                console.log(error)
            }
        })

      }



      </script>



           </div>
            <div class="flex justify-center">
              <button class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
                Load more
              </button>
            </div>
          </div>






      <div class="rounded-lg border bg-card text-card-foreground shadow-sm" data-v0-t="card">
        <div class="flex flex-col space-y-1.5 p-4">
          <div class="flex items-center space-x-4">
            <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="h-6 w-6"
            >
              <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
            <h2 class="text-lg font-bold tracking-tight">Shipping address</h2>
          </div>
        </div>
        <div class="p-4">
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
              <p class="font-semibold">John Doe</p>
              <p>123 Street</p>
              <p>Springfield, IL 62701</p>
              <p>United States</p>
            </div>
            <div class="flex justify-end">
              <button class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-9 rounded-md px-3">
                Edit
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="rounded-lg border bg-card text-card-foreground shadow-sm" data-v0-t="card">
        <div class="flex flex-col space-y-1.5 p-4">
          <div class="flex items-center space-x-4">
            <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="h-6 w-6"
            >
              <rect width="20" height="14" x="2" y="5" rx="2"></rect>
              <line x1="2" x2="22" y1="10" y2="10"></line>
            </svg>
            <h2 class="text-lg font-bold tracking-tight">Payment method</h2>
          </div>
        </div>
        <div class="p-4">
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
              <p class="font-semibold">Credit card</p>
              <p>Ending in 4242</p>
            </div>
            <div class="flex justify-end">
              <button class="inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-9 rounded-md px-3">
                Change
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="rounded-lg border bg-card text-card-foreground shadow-sm" data-v0-t="card">
        <div class="flex flex-col space-y-1.5 p-4">
          <div class="flex items-center space-x-4">
            <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="h-6 w-6"
            >
              <polyline points="20 12 20 22 4 22 4 12"></polyline>
              <rect width="20" height="5" x="2" y="7"></rect>
              <line x1="12" x2="12" y1="22" y2="7"></line>
              <path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"></path>
              <path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"></path>
            </svg>
            <h2 class="text-lg font-bold tracking-tight">Special instructions</h2>
          </div>
        </div>
        <div class="p-4">
          <p class="text-sm text-gray-500 dark:text-gray-400">Add special instructions to the seller</p>
        </div>
      </div>
      <div class="rounded-lg border bg-card text-card-foreground shadow-sm" data-v0-t="card">
        <div class="flex flex-col space-y-1.5 p-4">
          <div class="flex items-center space-x-4">
            <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="h-6 w-6"
            >
              <polyline points="20 12 20 22 4 22 4 12"></polyline>
              <rect width="20" height="5" x="2" y="7"></rect>
              <line x1="12" x2="12" y1="22" y2="7"></line>
              <path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"></path>
              <path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"></path>
            </svg>
            <h2 class="text-lg font-bold tracking-tight">Special instructions</h2>
          </div>
        </div>
        <div class="p-4">
          <p class="text-sm text-gray-500 dark:text-gray-400">Add special instructions to the seller</p>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
</div>
</body>




</html>